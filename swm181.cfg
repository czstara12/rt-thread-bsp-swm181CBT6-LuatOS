# Synwit SWM181 Cortex-M0 OpenOCD Configuration
# SWM181: ARM Cortex-M0, 64KB/128KB Flash, 8KB SRAM

# Set the CHIPNAME
set _CHIPNAME swm181

# Transport selection (SWD)
transport select swd

# SWD IDCODE for Cortex-M0
set _CPUTAPID 0x0bc11477

# Create the DAP
swd newdap $_CHIPNAME cpu -expected-id $_CPUTAPID

# Create DAP instance
dap create $_CHIPNAME.dap -chain-position $_CHIPNAME.cpu

# Create target (Cortex-M0)
set _TARGETNAME $_CHIPNAME.cpu
target create $_TARGETNAME cortex_m -dap $_CHIPNAME.dap

# Working area configuration (8KB SRAM at 0x20000000)
$_TARGETNAME configure -work-area-phys 0x20000000 -work-area-size 0x2000

# Flash configuration using generic driver
# Flash size: 128KB (0x20000) - adjust to 0x10000 for 64KB variant
set _FLASHNAME $_CHIPNAME.flash
flash bank $_FLASHNAME stm32f1x 0x00000000 0x20000 0 0 $_TARGETNAME

# Reset configuration
reset_config srst_only srst_nogate
adapter srst delay 100
adapter srst pulse_width 100

# Speed configuration
adapter speed 4000

# Initialize
init
targets $_TARGETNAME
reset halt
